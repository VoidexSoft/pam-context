---
phase: 04-frontend-dead-code-cleanup
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - web/src/components/SearchFilters.tsx
  - web/src/pages/DocumentsPage.tsx
  - web/src/pages/AdminDashboard.tsx
  - web/src/App.tsx
  - web/src/components/chat/CitationTooltip.tsx
  - web/src/components/SourceViewer.tsx
  - web/src/components/CitationLink.tsx
  - src/pam/api/auth.py
  - tests/test_api/test_auth.py
  - eval/run_eval.py
autonomous: true
requirements:
  - FE-04
  - FE-05
  - FE-06
  - FE-07
  - FE-08

must_haves:
  truths:
    - "All interactive elements across the entire frontend have aria-label attributes (filter buttons, document page inputs/buttons, admin refresh, sign-out, citation buttons, source viewer backdrop)"
    - "CitationLink.tsx is deleted from the codebase (dead component with no imports)"
    - "require_auth function no longer exists in auth.py and its test class TestRequireAuth is removed from test_auth.py"
    - "eval print_summary handles empty questions list without division by zero"
    - "FE-06 (orig_idx) is verified as pre-satisfied -- no action needed"
  artifacts:
    - path: "web/src/components/SearchFilters.tsx"
      provides: "aria-label and aria-pressed on every filter button"
      contains: "aria-label"
    - path: "web/src/pages/DocumentsPage.tsx"
      provides: "aria-labels on folder input, ingest button, refresh button"
      contains: "aria-label"
    - path: "web/src/pages/AdminDashboard.tsx"
      provides: "aria-label on refresh button"
      contains: "aria-label"
    - path: "web/src/App.tsx"
      provides: "aria-labels on sign-out button and mobile menu overlay"
      contains: "aria-label"
    - path: "web/src/components/chat/CitationTooltip.tsx"
      provides: "aria-label on citation buttons"
      contains: "aria-label"
    - path: "web/src/components/SourceViewer.tsx"
      provides: "aria-label on backdrop overlay"
      contains: "aria-label"
    - path: "eval/run_eval.py"
      provides: "Early return guard in print_summary for total == 0"
      contains: "if total == 0"
  key_links:
    - from: "src/pam/api/auth.py"
      to: "tests/test_api/test_auth.py"
      via: "require_auth removed from both source and tests"
      pattern: "require_auth"
---

<objective>
Add aria-label accessibility attributes to all remaining interactive elements across the frontend, remove dead code (CitationLink.tsx, require_auth), and guard division-by-zero in eval.

Purpose: Ensure screen readers can identify all interactive elements (WCAG compliance), remove dead code that confuses future maintainers, and prevent eval crashes on empty input.

Output: Six frontend files with new aria-labels, one deleted component, two backend files cleaned of dead code, and one eval file hardened.
</objective>

<execution_context>
@/Users/datnguyen/.claude/get-shit-done/workflows/execute-plan.md
@/Users/datnguyen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-frontend-dead-code-cleanup/04-RESEARCH.md

@web/src/components/SearchFilters.tsx
@web/src/pages/DocumentsPage.tsx
@web/src/pages/AdminDashboard.tsx
@web/src/App.tsx
@web/src/components/chat/CitationTooltip.tsx
@web/src/components/SourceViewer.tsx
@web/src/components/CitationLink.tsx
@src/pam/api/auth.py
@tests/test_api/test_auth.py
@eval/run_eval.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add aria-labels to all remaining interactive elements</name>
  <files>
    web/src/components/SearchFilters.tsx
    web/src/pages/DocumentsPage.tsx
    web/src/pages/AdminDashboard.tsx
    web/src/App.tsx
    web/src/components/chat/CitationTooltip.tsx
    web/src/components/SourceViewer.tsx
  </files>
  <action>
Add aria-label attributes to every interactive element that currently lacks one. Use action-based labels for buttons and descriptive labels for inputs (consistent with existing codebase style -- CodeBlock has "Copy code", SourceViewer has "Close").

**SearchFilters.tsx:**
- Each filter button: add `aria-label={`Filter by ${type.label}`}` (or similar using the type's display label).
- Each filter button: add `aria-pressed={isActive}` to indicate toggle state for screen readers.

**DocumentsPage.tsx:**
- Folder path input: add `aria-label="Folder path to ingest"`.
- Ingest button: add `aria-label="Start ingestion"`.
- Refresh button: add `aria-label="Refresh document list"`.

**AdminDashboard.tsx:**
- Refresh button: add `aria-label="Refresh dashboard"`.

**App.tsx:**
- Sign out button: add `aria-label="Sign out"`.
- Mobile menu overlay/backdrop (if present as a clickable element): add `aria-label="Close menu"`.
- The hamburger button already has `aria-label="Open menu"` -- leave it.

**CitationTooltip.tsx:**
- Citation button(s): add `aria-label` with the citation title, e.g., `aria-label={`View source: ${citation.title}`}`. If title is not available at that scope, use a generic `aria-label="View citation source"`.

**SourceViewer.tsx:**
- Backdrop overlay (the div behind the modal): add `aria-label="Close source viewer"` and `role="button"` if it handles click-to-close.
- The close button already has `aria-label="Close"` -- leave it.
  </action>
  <verify>
- Run `cd /Users/datnguyen/Projects/AI-Projects/pam-context/web && npx tsc --noEmit` -- no TypeScript errors.
- Run `cd /Users/datnguyen/Projects/AI-Projects/pam-context/web && npx vitest run` -- all tests pass.
- Grep for `aria-label` in each modified file:
  - `grep -c 'aria-label' web/src/components/SearchFilters.tsx` -- at least 1 match.
  - `grep -c 'aria-label' web/src/pages/DocumentsPage.tsx` -- at least 3 matches.
  - `grep -c 'aria-label' web/src/pages/AdminDashboard.tsx` -- at least 1 match.
  - `grep -c 'aria-label' web/src/App.tsx` -- at least 2 matches (Open menu + Sign out).
  - `grep -c 'aria-label' web/src/components/chat/CitationTooltip.tsx` -- at least 1 match.
  - `grep -c 'aria-label' web/src/components/SourceViewer.tsx` -- at least 2 matches (Close + backdrop).
- Grep for `aria-pressed` in SearchFilters.tsx -- at least 1 match.
  </verify>
  <done>
All interactive elements across the frontend have aria-label attributes. Filter buttons include aria-pressed for toggle state. Labels use action-based style for buttons and descriptive style for inputs, consistent with existing codebase conventions.
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove dead code and guard eval division-by-zero</name>
  <files>
    web/src/components/CitationLink.tsx
    src/pam/api/auth.py
    tests/test_api/test_auth.py
    eval/run_eval.py
  </files>
  <action>
**1. Delete CitationLink.tsx** (FE-04):
- Delete the file `web/src/components/CitationLink.tsx`. It is not imported anywhere in the codebase (verified in research). Use `rm` or equivalent.
- Verify no imports reference it: `grep -r 'CitationLink' web/src/` should return nothing (or only the deleted file).

**2. Remove require_auth from auth.py** (FE-05):
- In `src/pam/api/auth.py`, remove the `require_auth` function (research identified it at lines 85-94). This is a dead function -- no route imports it.
- Do NOT remove `require_role` or any other function -- only `require_auth`.

**3. Remove TestRequireAuth from test_auth.py** (FE-05):
- In `tests/test_api/test_auth.py`, remove the `TestRequireAuth` class (research identified it at lines 258-280).
- Remove the `require_auth` import from the imports at the top of the file (research identified it at line 17). Only remove the `require_auth` name from the import -- keep any other names imported from the same line.
- Verify: `grep -r 'require_auth' src/ tests/` should return nothing after removal.

**4. Verify FE-06 pre-satisfied** (FE-06):
- Run `grep -r 'orig_idx' src/pam/ingestion/embedders/` to confirm `orig_idx` does not exist in the current codebase. If it does exist (unexpected), remove the unused variable. If it does not exist, no action needed -- requirement is pre-satisfied.

**5. Guard division-by-zero in print_summary** (FE-08):
- In `eval/run_eval.py`, find the `print_summary` function.
- Add an early return guard at the top of the function body, after computing `total = len(questions)`:
  ```python
  if total == 0:
      print("\n" + "=" * 72)
      print("EVALUATION SUMMARY")
      print("=" * 72)
      print("\nNo questions to evaluate.")
      print("=" * 72)
      return
  ```
- This ensures all subsequent division by `total` is safe.
  </action>
  <verify>
- `ls web/src/components/CitationLink.tsx` should fail (file deleted).
- `grep -r 'CitationLink' web/src/` should return no matches.
- `grep -r 'require_auth' src/pam/api/auth.py` should return no matches.
- `grep -r 'require_auth' tests/test_api/test_auth.py` should return no matches.
- `grep -r 'TestRequireAuth' tests/test_api/test_auth.py` should return no matches.
- `grep -r 'orig_idx' src/pam/ingestion/embedders/` should return no matches (pre-satisfied).
- `grep -n 'if total == 0' eval/run_eval.py` should return a match.
- Run `cd /Users/datnguyen/Projects/AI-Projects/pam-context && python -m pytest tests/test_api/test_auth.py -x -q` -- all remaining tests pass (no import errors from removed require_auth).
- Run `cd /Users/datnguyen/Projects/AI-Projects/pam-context && python -c "from eval.run_eval import print_summary; print_summary({'questions': []})"` -- should print summary with "No questions to evaluate" and not crash.
  </verify>
  <done>
CitationLink.tsx deleted (dead component). require_auth function removed from auth.py and TestRequireAuth class + import removed from test_auth.py. FE-06 (orig_idx) confirmed pre-satisfied. eval print_summary guards against empty questions list with early return.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation: `cd web && npx tsc --noEmit` passes with zero errors.
2. Frontend test suite: `cd web && npx vitest run` passes all tests.
3. Python test suite: `pytest tests/test_api/test_auth.py -x -q` passes (no broken imports).
4. Dead code removed: CitationLink.tsx does not exist, require_auth not found in source or tests.
5. Accessibility: Every interactive element in SearchFilters, DocumentsPage, AdminDashboard, App, CitationTooltip, SourceViewer has an aria-label attribute.
6. Eval guard: print_summary({questions: []}) completes without error.
</verification>

<success_criteria>
- All 6 frontend files have aria-label attributes on every interactive element.
- SearchFilters buttons have aria-pressed for toggle state.
- CitationLink.tsx is deleted with no remaining references.
- require_auth function removed from auth.py; TestRequireAuth class and import removed from test_auth.py.
- orig_idx confirmed absent (FE-06 pre-satisfied).
- print_summary handles total == 0 gracefully.
- TypeScript compiles cleanly, all frontend and backend tests pass.
</success_criteria>

<output>
After completion, create `.planning/phases/04-frontend-dead-code-cleanup/04-02-SUMMARY.md`
</output>
