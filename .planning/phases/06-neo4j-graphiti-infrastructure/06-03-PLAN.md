---
phase: 06-neo4j-graphiti-infrastructure
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - web/package.json
  - web/src/App.tsx
  - web/src/pages/GraphPage.tsx
  - web/src/api/client.ts
autonomous: true
requirements: [INFRA-06]

must_haves:
  truths:
    - "@neo4j-nvl/react, @neo4j-nvl/base, and @neo4j-nvl/interaction-handlers are installed in web/ project"
    - "/graph route exists and renders a placeholder page with graph status summary"
    - "Nav item for Graph is visible but disabled (grayed out with tooltip) when VITE_GRAPH_ENABLED is not true"
    - "Nav item for Graph is an active NavLink when VITE_GRAPH_ENABLED=true"
    - "Graph page fetches and displays Neo4j connection status, entity counts, and last sync time"
  artifacts:
    - path: "web/package.json"
      provides: "NVL package dependencies"
      contains: "@neo4j-nvl/react"
    - path: "web/src/pages/GraphPage.tsx"
      provides: "Graph status placeholder page component"
      contains: "GraphPage"
    - path: "web/src/App.tsx"
      provides: "Feature-flagged /graph route and nav item"
      contains: "VITE_GRAPH_ENABLED"
    - path: "web/src/api/client.ts"
      provides: "getGraphStatus() API function"
      contains: "getGraphStatus"
  key_links:
    - from: "web/src/App.tsx"
      to: "web/src/pages/GraphPage.tsx"
      via: "Route element={<GraphPage />}"
      pattern: "Route.*GraphPage"
    - from: "web/src/pages/GraphPage.tsx"
      to: "web/src/api/client.ts"
      via: "getGraphStatus() fetch call"
      pattern: "getGraphStatus"
    - from: "web/src/api/client.ts"
      to: "GET /api/graph/status"
      via: "request<GraphStatus>(\"/graph/status\")"
      pattern: "graph/status"
---

<objective>
Install @neo4j-nvl packages, add feature-flagged /graph route with disabled nav item, create placeholder graph status page that shows Neo4j connection status and entity counts.

Purpose: Prepares the frontend for the graph explorer (Phase 9) while providing immediate visibility into graph health once Neo4j is running. NVL packages are ready for Phase 9 without any further npm installs.
Output: NVL packages installed, /graph route with placeholder page, feature-flagged nav item.
</objective>

<execution_context>
@/Users/datnguyen/.claude/get-shit-done/workflows/execute-plan.md
@/Users/datnguyen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-neo4j-graphiti-infrastructure/06-CONTEXT.md
@.planning/phases/06-neo4j-graphiti-infrastructure/06-RESEARCH.md
@web/src/App.tsx
@web/src/api/client.ts
@web/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install NVL packages + API client + GraphPage component</name>
  <files>
    web/package.json
    web/src/api/client.ts
    web/src/pages/GraphPage.tsx
  </files>
  <action>
1. Install NVL packages in web/:
   ```
   cd web && npm install @neo4j-nvl/base @neo4j-nvl/react @neo4j-nvl/interaction-handlers
   ```
   This updates package.json and package-lock.json automatically.

2. Add `GraphStatus` interface and `getGraphStatus()` function to `web/src/api/client.ts`:
   - Add interface near the other interfaces:
     ```typescript
     export interface GraphStatus {
       status: string;
       entity_counts: Record<string, number>;
       total_entities: number;
       last_sync_time: string | null;
       error?: string;
     }
     ```
   - Add function near the other API functions:
     ```typescript
     export function getGraphStatus(): Promise<GraphStatus> {
       return request<GraphStatus>("/graph/status");
     }
     ```

3. Create `web/src/pages/GraphPage.tsx`:
   - Import `useEffect`, `useState` from React
   - Import `getGraphStatus`, `GraphStatus` from `../api/client`
   - Component fetches graph status on mount via `useEffect`
   - Shows loading spinner/text while fetching
   - Shows error state if fetch fails
   - On success, renders:
     a. Page header: "Knowledge Graph" with a brief subtitle
     b. Top row of 3 stat cards (following AdminDashboard's StatCard pattern):
        - "Neo4j Status" showing status (connected/disconnected) with a colored indicator (green dot for connected, red for disconnected)
        - "Total Entities" showing total_entities count
        - "Last Sync" showing last_sync_time formatted, or "Never" if null
     c. If entity_counts has entries, a grid of cards showing count per entity type (Person: N, Team: N, etc.)
     d. If entity_counts is empty, a subtle message: "No entities yet. Run an ingestion to populate the knowledge graph."
   - Style with Tailwind classes consistent with AdminDashboard (bg-white rounded-xl border p-5 pattern)
   - Use the same StatCard component pattern from AdminDashboard (define locally in the file -- don't import from AdminDashboard to avoid coupling)
   - Include a manual refresh button (similar to AdminDashboard's refresh)
   - All interactive elements must have aria-labels (project accessibility convention)
  </action>
  <verify>
- `cd web && node -e "require('@neo4j-nvl/react'); console.log('NVL OK')"` prints NVL OK (or use import syntax if ESM issues -- try `node --input-type=module -e "import '@neo4j-nvl/react'; console.log('NVL OK')"`)
- `cd web && npx tsc --noEmit` exits 0 (TypeScript compiles without errors)
- GraphPage.tsx contains GraphStatus fetch, stat cards, entity count grid
  </verify>
  <done>NVL packages installed in web/. GraphPage component renders graph status with entity counts. getGraphStatus() API function added to client.ts.</done>
</task>

<task type="auto">
  <name>Task 2: Feature-flagged route and nav item in App.tsx</name>
  <files>
    web/src/App.tsx
  </files>
  <action>
1. Update `web/src/App.tsx`:
   - Import `GraphPage` from `./pages/GraphPage`
   - Read feature flag: `const graphEnabled = import.meta.env.VITE_GRAPH_ENABLED === "true";` at the top of the App component (before return)

2. Add Graph nav item to the Sidebar:
   - Per user decision: nav item is **visible but disabled** (grayed out with tooltip) when VITE_GRAPH_ENABLED is not "true"
   - Do NOT add Graph to the NAV_ITEMS array (since it has special conditional rendering)
   - Instead, render it separately after the NAV_ITEMS map in the `<nav>` element
   - When graphEnabled is true: render a standard `<NavLink to="/graph">` with the same `linkClass` and styling as other nav items
   - When graphEnabled is false: render a `<span>` with grayed-out styling (`text-gray-300 cursor-not-allowed`) and a `title="Graph explorer not yet enabled"` tooltip
   - Icon: use a simple graph/network SVG icon (nodes connected by edges -- use an inline SVG similar to existing nav icons, approximately: three circles connected by two lines)
   - The icon + label should match the visual weight of existing nav items

3. Add the /graph route:
   - In the `<Routes>` block, add `<Route path="/graph" element={<GraphPage />} />` after the admin route
   - This route is always registered -- the feature flag controls nav visibility, not route existence (direct URL access works regardless of flag for dev convenience)

4. Ensure the disabled nav item is properly styled:
   - Same flex/gap/padding/rounded as active links
   - `text-gray-300` for the grayed-out state (lighter than the normal `text-gray-600`)
   - `cursor-not-allowed` to indicate non-interactive
   - `title` attribute provides the tooltip text

All changes must pass TypeScript compilation (`npx tsc --noEmit`).
  </action>
  <verify>
- `cd web && npx tsc --noEmit` exits 0
- `cd web && npm run build` exits 0 (full build succeeds)
- App.tsx contains `VITE_GRAPH_ENABLED` check, conditional nav rendering, and `/graph` Route
  </verify>
  <done>Graph nav item is visible but disabled when VITE_GRAPH_ENABLED !== "true". When enabled, it links to /graph which renders GraphPage. Route is always registered for dev access.</done>
</task>

</tasks>

<verification>
- NVL packages appear in web/package.json dependencies
- `npx tsc --noEmit` passes in web/ directory
- `npm run build` succeeds in web/
- App.tsx reads VITE_GRAPH_ENABLED and conditionally renders nav item
- GraphPage.tsx fetches /api/graph/status and displays results
- client.ts exports getGraphStatus() and GraphStatus interface
</verification>

<success_criteria>
- @neo4j-nvl/base, @neo4j-nvl/react, @neo4j-nvl/interaction-handlers all in web/package.json
- TypeScript compiles with no errors
- Vite build succeeds
- /graph route renders GraphPage component
- Nav shows Graph item (grayed when flag off, active link when flag on)
</success_criteria>

<output>
After completion, create `.planning/phases/06-neo4j-graphiti-infrastructure/06-03-SUMMARY.md`
</output>
